# 2정규형

유저 테이블:
| 유저번호 | 유저ID |
여기서 유저번호 → 유저ID라는 함수적 종속관계가 성립

수강 테이블:
| 유저번호 | 수강명 | 성취도 |
테이블의 기본키는 {유저번호, 수강명}이며, 성취도는 복합키에 완전 종속됨

## 기본키와 릴레이션 분리

“기본키인 {유저ID, 수강명}”이라고 표현하는 경우는 보통 자연키를 사용할 때 해당하지만, 여기서는 유저번호를 통해 유저 정보를 별도 테이블로 관리하는 대리키 방식

유저 릴레이션에서는
| 유저번호 | 유저ID |
여기서 유저번호가 기본키이며, 유저ID는 유저번호에 완전 함수적 종속됨
즉, 유저번호가 결정되면 유저ID가 결정되므로 = 2NF

수강 릴레이션에서는
| 유저번호 | 수강명 | 성취도 |
여기서 기본키를 {유저번호, 수강명}으로 정의하고, 성취도는 복합키에 완전 종속됨

# 클러스터형 인덱스

- 기본키 컬럼에 자동으로 생성되며, 실제 데이터가 인덱스의 리프노드에 저장되므로 조회 성능이 좋움
- 만약 기본키 외의 다른 컬럼을 클러스터형 인덱스로 사용하고 싶다면 UNIQUE NOT NULL 옵션을 통해 설정할 수 았음

### 하나의 인덱스만 생성할 것이라면 클러스터형 인덱스를 만드는 게 세컨더리 인덱스를 만드는 것보다 성능이 좋을까?

- 클러스터형 인덱스는 인덱스의 리프 노드에 실제 데이터가 저장되어 있기 때문에 인덱스를 통해 데이터를 찾으면 바로 해당 데이터를 읽어올 수 있음

- 반면, 세컨더리 인덱스는 실제 데이터에 대한 포인터를 저장, 세컨더리 인덱스를 사용해 데이터를 찾을 경우에는 관련 포인터를 찾고,
  그 포인터를 이용해 다시 클러스터형 인덱스에서 실제 데이터를 조회해야 함

- 이 조회 단계로 인해 I/O 작업이 늘어나고, 결과적으로 성능이 떨어지게 됨

# 레플리카셋

### 정의:

동일한 데이터의 복제본을 여러 서버(노드)에 유지하여, 한 서버에 장애가 발생하더라도 데이터의 가용성과 안정성을 보장하는 구성 방식

### 구성 요소:

- Primary Node: 모든 쓰기 작업이 발생하는 주 서버
- Secondary Nodes: Primary에서 발생한 변경 사항을 복제받아 저장하는 보조 서버들

### 작동 방식:

- 쓰기 작업: 모든 쓰기 작업은 Primary에서 이루어지며, 이 변경 사항이 Secondary에 비동기적으로 복제됨
- 장애 조치: 만약 Primary에 장애가 발생하면, Secondary 중 하나가 자동으로 Primary로 승격되어 서비스 중단 없이 운영이 지속됨

### 장점:

1. 높은 가용성: 하나의 노드에 장애가 발생해도 다른 노드에서 서비스를 지속할 수 있음
2. 데이터 안정성: 데이터 복제를 통해 손실 가능성을 줄임
3. 읽기 부하 분산: 읽기 작업을 Secondary에 분산시켜 전체 성능 향상 가능

# 샤딩

### 정의:

대규모 데이터셋을 여러 서버(또는 샤드)에 분산 저장하여, 단일 서버의 용량 한계를 극복하고 성능을 높이는 방법

### 구성 요소:

- Shard: 데이터의 일부를 저장하는 독립적인 서버 또는 서버 그룹
- mongos: 클라이언트와 샤드 사이에서 쿼리 라우터 역할을 하며, 어느 샤드에 데이터가 위치하는지를 결정
- Config Server: 클러스터 구성 및 메타데이터(데이터 분포 정보 등)를 저장하고 관리하는 서버

### 작동 방식:

데이터가 특정 샤딩 키를 기준으로 여러 샤드에 분산 저장
클라이언트의 쿼리는 몽고S를 통해 적절한 샤드로 라우팅되어 처리

### 장점:

- 수평적 확장성: 데이터 용량이나 트래픽이 증가해도 새로운 샤드를 추가함으로써 쉽게 확장이 가능
- 부하 분산: 데이터가 여러 서버에 분산되어 저장되므로, 각 서버의 부하가 줄어듬
- 높은 처리량: 여러 서버가 병렬로 작업을 처리할 수 있어 전체 성능이 향상

### 추가 조인의 종류

**Cross Join**

모든 경우의 수를 전부 표현해주는 방식

A가 3개, B가 4개면 총 3\*4= 12개의 데이터가 검색 됨

**Self Join**

자기자신과 자기자신을 조인하는 것

하나의 테이블을 여러번 복사해서 조인한다고 생각하면 편함

자신이 갖고 있는 칼럼을 다양하게 변형시켜 활용할 때 자주 사용
