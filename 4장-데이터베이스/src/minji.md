# 데이터베이스의 기본

데이터베이스(DB, DataBase)는 일정한 규칙 혹은 규악을 통해 구조화되어 저장된 데이터들의 모음을 말함

- DBMS(Database Management System): 데이터베이스를 제어, 관리하는 통합 시스템
- DBMS마다 정의된 쿼리 언어를 통해 데이터 삽입, 삭제, 수정, 조회 할 수 있음
- 실시간 접근과 동시 공유 가능
- 응용프로그램 <-> DBMS <-> 데이터베이스

<br/><br/>

## 엔터티(Entity)

엔터티(entity)란 여러 개의 속성을 가진 명사를 의미함(ex.엔터티: 회원, 회원엔터티 속성: 이름, 아이디, 주소 등)

- 엔터티의 속성은 서비스의 요구사항에 따라 정해짐
- 혼자는 존재하지 못하고 다른 엔터티의 존재 여부에 종속적이면 약한 엔터티, 그렇지 않으면 강한 엔터티라고 함

<br/><br/>

## 릴레이션(Relation)

릴레이션(relation)이란 데이터베이스에서 정보를 구분하여 저장하는 기본 단위를 의미함

- 관계형 데이터베이스에선 **테이블**, NoSQL 데이터베이스에선 **컬렉션** 이라고 함
- MySQL 구조(관계형 데이터베이스): 레코드-테이블-데이터베이스 / MongoDB(NoSQL): 도큐먼트-컬렉션-데이터베이스
- 레코드(테이블의 한 행)가 쌓여서 테이블이 되고, 테이블이 쌓여서 DB가 됨

<br/><br/>

## 속성(Attribute)

속성(attribute)이란 릴레이션에서 관리하는 구체적이고 고유한 이름을 갖는 정보를 의미함

<br/><br/>

## 도메인(Domain)

도메인(domain)이란 릴레이션에 포함된 각각의 속성들이 가질 수 있는 값들의 집합을 의미함(ex.성별 속성의 도메인은 {남, 여})

<br/><br/>

## 필드와 레코드

- 엔터티 - 테이블(ex. 회원 엔터티 - member 테이블)
- 속성 - 필드(ex. 이름, 성별, 주소 속성 - name, gender, address 필드)
- 테이블 행 - 레코드(튜플이라고도 함)

### 필드 타입

#### 숫자 타입

TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT 등

#### 날짜 타입

| 타입      | 표현 데이터 | 용량    |
| --------- | ----------- | ------- |
| DATE      | 날짜만      | 3바이트 |
| DATETIME  | 날짜+시간   | 8바이트 |
| TIMESTAMP | 날짜+시간   | 4바이트 |

#### 문자 타입

CHAR, VARCHAR, TEXT, BLOB, ENUM, SET

- CHAR, VARCHAR
  - 수를 입력해서 몇 자까지 입력할지 정할 수 있음(ex.CHAR(10), VARCHAR(100))
  - CHAR 는 레코드의 값과 무관하게 고정 길이로 저장, VARCHAR 는 입력된 데이터에 따라 가변 길이로 저장
- TEXT, BLOB
  - 큰 데이터를 저장할 때 쓰는 타입으로 TEXT 는 긴 문자열, BLOB 은 이미지, 동영상 등을 저장함
  - 단 요즘은 이미지 호스팅 서비스인 s3 서비스를 사용하는 등 서버에 파일 업로드 후 경로를 VARCHAR 로 저장하는 경우가 많음
- ENUM, SET

  <table>
    <thead>
      <tr>
        <th colspan="2">항목</th>
        <th>ENUM</th>
        <th>SET</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td rowspan="2">공통점</td>
        <td>장점</td>
        <td colspan="2">메모리를 적게 사용함</td>
      </tr>
      <tr>
        <td>단점</td>
        <td colspan="2">애플리 케이션 수정이 생기면 정의한 목록 수정해야 함</td>
      </tr>
      <tr>
        <td rowspan="4">차이점</td>
        <td>선택 가능한 값 수</td>
        <td>단일 선택</td>
        <td>다중 선택</td>
      </tr>
      <tr>
        <td>저장 방식</td>
        <td>내부적으로 숫자 인덱스로 저장</td>
        <td>비트 필드로 저장</td>
      </tr>
      <tr>
        <td>비트 연산</td>
        <td>X(하나만 선택 하기 때문에 불필요)</td>
        <td>O</td>
      </tr>
      <tr>
        <td>최대 요소 개수</td>
        <td>65,535개</td>
        <td>64개</td>
      </tr>

    </tbody>
  </table>

  - 문자열을 열거한 타입(ex. ENUM('option1', 'option2'), SET('option1', 'option2'))
  - ENUM 타입에서 리스트에 없는 잘못된 값을 삽입하면 빈 문자열이 대신 삽입됨

<br/><br/>

## 관계

- DB에는 여러개의 테이블이 정의되어 있고 서로의 관계가 정의되어있음
- 관계는 관계화살표로 나타냄
  <img src="https://blog.kakaocdn.net/dn/bcwCAD/btrhMtkXNcd/gAkHT1rMWKPWTIQezHEKu0/img.jpg">

### 1:1 관계

- ex.유저 테이블 - 유저 이메일 테이블
- 테이블을 두 개의 테이블로 나눠 테이블의 구조를 더 이해하기 쉽게 함

### 1:N 관계

- ex. 유저 테이블 - 상품 테이블(한 장바구니에 0개 이상의 상품)
- 한 개체가 다른 많은 개체를 포함하는 관계

### N:M 관계

- ex. 학생 테이블 - 강의 테이블(학생이 여러개의 강의 수강, 강의에 여려 학생이 포함)
- 두 테이블을 직접적으로 연결해서 구축하지 않고, 각 테이블과 1:N, 1:M 이라는 관계를 갖는 테이블을 만들어 설정함

<br/><br/>

## 키

키는 테이블 간의 관계를 좀 더 명확하게 하고 테이블 자체의 인덱스를 위해 설정된 장치

- 기본키, 외래키, 후보키, 슈퍼키, 대체키가 존재함
- 기본키, 대체키 ⊂ 후보키 ⊂ 슈퍼키
- 슈퍼키는 유일성, 후보키는 최소성까지 갖춤. 후보키 중에서 기본키로 선택되지 못한 키는 대체키가 됨
- 유일성: 중복되는 값이 없음
- 최소성: 필드 조합 없이 최소 필드만 써서 키를 형성할 수 있음

### 기본키(PK, Primary Key)

- 유일성과 최소성을 만족함
- 자연키와 인조키 중에 골라서 설정함
- 자연키: 자연스럽게 나오는 속성. 언젠간 변하는 속성을 가짐
- 인조키: 인위적으로 아이디를 부여해 만들어진 고유 식별자. 오라클은 sequence, MySQL 은 auto increment 등으로 설정함. 속성이 변하지 않음. 보통 인조키가 기본키로 설정됨

### 외래키(FK, Foreign Key)

다른 테이블의 기본키를 그대로 참조하는 값으로 개체와의 관계를 식별하는데 사용. 중복이 가능함

### 후보키(Candidate Key)

기본키가 될 수 있는 후보들로 유일성과 최소성을 동시에 만족시킴

### 대체키(Alternate Key)

후보키가 두 개 이상일 경우 기본키로 설정된 것을 제외한 남은 후보키들

### 슈퍼키(Super Key)

각 레코드를 유일하게 식별할 수 있는 유일성을 갖춘 키

<br/><br/><br/><br/>

# ERD 와 정규화 과정

ERD(Entity Relationship Diagram)은 릴레이션 간의 관계들을 정의한 것을 의미함

## ERD의 중요성

- 시스템 요구 사항을 기반으로 작성 되며 ERD 를 기반으로 데이터베이스를 구축함
- 데이터베이스 구축 이후에도 디버깅 또는 비즈니스 프로세스 재설계가 필요할 때 설계도 역할을 함
- 장점: 관계형 구조로 표현 가능한 데이터를 구성하는 데 유용
- 단점: 비정형 데이터를 충분히 표현할 수 없음

## 정규화 과정

정규화 과정이란 릴레이션 간의 잘못된 종속 관계로 인해 데이터베이스 이상 현상이 일어나서 이를 해결하거나, 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정을 말함

- 정규형 원칙을 기반으로 정규형을 만들어가고 정규화된 정도는 정규형(NF, Normal Form)으로 표현
- 기본 정규형: 제1정규형, 제2정규형, 제3정규형, 보이스/코드 정규형
- 고급 정규형: 제4정규형, 제5정규형
- 정규형 과정을 거쳐 테이블을 나눠도 성능이 100% 좋아지는 것은 아님. 조인이 필요해지는 경우가 생겨 느려질 수 있기 때문에 서비스에 따라 정규화/비정규화를 진행해야 함

### 정규형 원칙

- 자료의 중복성은 감소해야 함
- 독립적인 관계는 별개의 릴레이션으로 표현해야 함
- 각각의 릴레이션은 독립적인 표현이 가능해야 함

### 제1정규형

- 릴레이션의 모든 도메인이 더이상 분리될 수 없는 원자 값만으로 구성되어야 함
- 한 개의 기본키에 대해 두 개 이상의 값을 가지는 반복 집합이 있어선 안됨
- 반복 집합이 있다면 제거

### 제2정규형

- 릴레이션이 제1정규형이고 부분 함수의 종속성을 제거한 형태(기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것을 말함)
- 릴레이션 분해 시 동등한 릴레이션으로 분해해야 하고 무손실 분해로 분해되어야 함

### 제3정규형

제2정규형이고 기본키가 아닌 모든 속성이 이행적 함수 종속(transitive FD)를 만족해지 않는 상태

#### 이행적 함수 종속

A->B 와 B->C 가 존재하면 A->C 가 성립하는데, 이때 C가 집합 A에 이행적으로 함수 종속이 되었다고 함

### 보이스/코드 정규형(BCNF)

제3정규형이고, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 릴레이션의 함수 종속 관계에서 모든 결정자가 후보키인 상태를 말함

<br/><br/><br/><br/>

# 용어

- 비정형 데이터: 비구조화 데이터를 말하며, 미리 정의된 데이터 모델이 없거나 미리 정의된 방식으로 정리되지 않은 정보를 말함
- 결정자: 함수 종속 관계에서 특정 종속자를 결정 짓는 요소. X -> Y 일 때, X는 결정자, Y는 종속자
